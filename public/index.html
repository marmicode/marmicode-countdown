<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Marmicode Countdown</title>
    <style>
      body {
        background-image: url(background.png);
        background-position: center;
        background-attachment: fixed;
        background-repeat: no-repeat;
        background-size: cover;
        margin: 0;
      }

      .blur {
        position: absolute;
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(8px);
        height: 100vh;
        width: 100vw;
      }

      .container {
        position: absolute;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: space-evenly;
        height: 100%;
        width: 100%;
      }

      .logo {
        max-width: 400px;
      }

      .timer {
        color: #380030;
        text-shadow: white 0px 0px 6px;
        font-size: 10em;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="blur"></div>
    <div class="container">
      <img class="logo" src="marmicode-io.png" alt="Marmicode" />
      <div id="timer" class="timer" contenteditable>07:00</div>
      <div id="control-panel">
        <input id="music-checkbox" type="checkbox" checked /><span>Music</span>
        <button id="start" type="submit">START</button>
      </div>
    </div>
    <audio id="audio" loop>
      <source id="audio-source" type="audio/mpeg" />
    </audio>
    <script lang="javascript">
      const audioEl = document.querySelector('#audio');
      const audioSourceEl = document.querySelector('#audio-source');
      const musicCheckboxEl = document.querySelector('#music-checkbox');
      const controlPanelEl = document.querySelector('#control-panel');
      const startEl = document.querySelector('#start');
      const timerEl = document.querySelector('#timer');

      const main = () => {
        audioSourceEl.src = pickRandomMusic();
        startEl.addEventListener('click', () => start());
      }

      const pickRandomMusic = () => {
        /* More music here: https://www.unminus.com/ */
        const musicList = [
          'music.mp3',
          'https://feeds.soundcloud.com/stream/1000622302-unminus-moon-landing-countdown.mp3',
          'https://feeds.soundcloud.com/stream/827208181-unminus-autumn-allure.mp3'
        ];

        return musicList[Math.floor(Math.random() * musicList.length)];
      };

      const start = () => {
        const startTime = now();

        hideElement(controlPanelEl);

        if (isMusicEnabled()) {
          audioEl.play();
        }

        const duration = readTimer();

        const interval = setInterval(() => {
          const timeRemaining = duration - (now() - startTime);

          if (timeRemaining <= 0) {
            hideElement(timerEl);
            clearInterval(interval);
            return;
          }

          updateTimer(timeRemaining);
        }, 100);
      };

      const updateTimer = time => {
        const minutes = Math.floor(time / 60);
          const seconds = time % 60;
          timerEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      }

      const readTimer = () => {
        const text = timerEl.textContent;
        const [minutes, seconds] = text.split(':');
        return parseInt(minutes) * 60 + parseInt(seconds);
      }

      const hideElement = el => el.style.display = 'none';

      const isMusicEnabled = () => musicCheckboxEl.checked === true;

      const now = () => Math.round(Date.now() / 1000);

      main();
    </script>
  </body>
</html>
